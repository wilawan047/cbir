{% extends "_admin_layout.html" %}

{% block title %}Edit User{% endblock %}

{% block content %}
<style>
    body { font-family: 'Kanit', sans-serif; }
    .sidebar-link-active {
        background-color: #e0f2f7;
        color: #0284c7;
        font-weight: 600;
    }
</style>

<div class="flex min-h-screen">
    
    
    <!-- Main Content -->
    <main class="flex-1 p-8">
        <!-- Top Bar -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-1">แก้ไขผู้ใช้งาน</h1>
                <div class="text-gray-500 text-base">อัปเดตข้อมูลผู้ใช้งาน</div>
            </div>
            <a href="{{ url_for('admin_users') }}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white-200 rounded-lg hover:bg-blue-700 transition duration-150 ease-in-out">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                กลับหน้าจัดการผู้ใช้งาน
            </a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-3 rounded-md {% if category == 'success' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Form -->
        <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200">
            <form method="POST" action="{{ url_for('admin_edit_user', id=user.id) }}" class="space-y-6">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-6">
                        <!-- First Name -->
                        <div>
                            <label for="first_name" class="block text-sm font-medium text-gray-700 mb-1">ชื่อ</label>
                            <input type="text" id="first_name" name="first_name" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                value="{{ user.first_name }}"
                                placeholder="Enter first name">
                        </div>

                        <!-- Last Name -->
                        <div>
                            <label for="last_name" class="block text-sm font-medium text-gray-700 mb-1">นามสกุล</label>
                            <input type="text" id="last_name" name="last_name" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                value="{{ user.last_name }}"
                                placeholder="Enter last name">
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">อีเมล</label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                value="{{ user.email }}"
                                placeholder="Enter email address">
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-6">
                        <!-- Username -->
                        <div>
                            <label for="username" class="block text-sm font-medium text-gray-700 mb-1">ชื่อผู้ใช้งาน</label>
                            <input type="text" id="username" name="username" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                value="{{ user.username }}"
                                placeholder="Enter username">
                        </div>

                        <!-- Password (Optional) -->
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">รหัสผ่าน (ปล่อยว่างถ้าไม่เปลี่ยนรหัสผ่าน)</label>
                            <input type="password" id="password" name="password"
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter new password">
                        </div>

                        <!-- Role (editable by super admin only) -->
                        {% if is_super_admin %}
                        <div>
                            <label for="role" class="block text-sm font-medium text-gray-700 mb-1">บทบาท</label>
                            <select id="role" name="role" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                {% if user.role == 'superadmin' and other_super_admins == 0 %}disabled{% endif %}>
                                <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>ผู้ดูแลระบบ</option>
                                <option value="superadmin" {% if user.role == 'superadmin' %}selected{% endif %}>ผู้ดูแลระบบหลัก</option>
                            </select>
                            {% if user.role == 'superadmin' and other_super_admins == 0 %}
                            <p class="mt-1 text-sm text-gray-500">ไม่สามารถเปลี่ยนบทบาทของผู้ดูแลระบบหลักคนสุดท้ายได้</p>
                            {% endif %}
                        </div>
                        {% else %}
                        <input type="hidden" name="role" value="{{ user.role }}">
                        {% endif %}

                        <!-- Status -->
                        <div>
                            <label for="status" class="block text-sm font-medium text-gray-700 mb-1">สถานะ</label>
                            <select id="status" name="status" required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                {% if not is_super_admin and user.id == current_user_id %}disabled{% endif %}>
                                <option value="active" {% if user.status == 'active' %}selected{% endif %}>เปิดใช้งาน</option>
                                <option value="inactive" {% if user.status == 'inactive' %}selected{% endif %}>ปิดใช้งาน</option>
                            </select>
                            {% if not is_super_admin and user.id == current_user_id %}
                            <input type="hidden" name="status" value="{{ user.status }}">
                            <p class="mt-1 text-sm text-gray-500">ไม่สามารถเปลี่ยนสถานะบัญชีของตัวเองได้</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end">
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                        อัปเดตผู้ใช้งาน
                    </button>
                </div>
            </form>
        </div>
    </main>
</div>
{% endblock %}


